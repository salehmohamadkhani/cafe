# راهنمای تنظیم فراز SMS برای ارسال OTP

## مرحله 1: ساخت پترن در پنل فراز SMS

### اطلاعات مورد نیاز برای صفحه "ساخت پترن":

#### 1. عنوان پترن (Pattern Title)
```
ورود به پنل مدیریت - OTP
```
یا هر عنوان مناسب دیگری

#### 2. متن پترن (Pattern Text)
```
کد ورود شما: {otp}
این کد تا 5 دقیقه معتبر است.
```

**نکات مهم:**
- **حتماً نام مجموعه/برند خود را در متن قرار دهید** (مثلاً: "کد ورود شما به پنل مدیریت کافه مادلین: {otp}")
- اگر نام مجموعه در متن نباشد، پترن رد می‌شود
- می‌توانید به جای نام برند از لینک وب‌سایت استفاده کنید (با شرایط خاص)

**مثال کامل با نام مجموعه:**
```
کد ورود شما به پنل مدیریت کافه مادلین: {otp}
این کد تا 5 دقیقه معتبر است.
```

#### 3. ساخت متغیر (Variable)
- روی دکمه **"ساخت متغیر جدید"** کلیک کنید
- نام متغیر: `otp`
- نوع متغیر: **"رشته"** (String)
- این متغیر برای کد 6 رقمی OTP استفاده می‌شود

#### 4. توضیحات پترن (Pattern Description)
```
ارسال کد یکبار مصرف برای ورود به پنل مدیریت مرکزی
```

#### 5. وب‌سایت شما (Your Website)
آدرس وب‌سایت یا دامنه خود را وارد کنید (مثلاً: `https://yourdomain.com`)

### قوانین مهم:
- ✅ متن باید هدفمند باشد (ارسال رمز یکبار مصرف)
- ✅ نام مجموعه باید در متن باشد
- ✅ متغیر `otp` باید به درستی تعریف شود
- ❌ استفاده از نام مجموعه به عنوان متغیر ممنوع است
- ❌ لینک نمی‌تواند به متغیر تبدیل شود

---

## مرحله 2: دریافت کد پترن

بعد از تایید پترن توسط فراز SMS:
1. به بخش "پیامک‌های متغیردار (پترن)" بروید
2. کد پترن تایید شده را کپی کنید (مثلاً: `abc123def456`)
3. این کد را برای تنظیمات نیاز دارید

---

## مرحله 3: دریافت اطلاعات API

### روش 1: استفاده از Username/Password
1. به بخش "برنامه نویسان" یا "API" در پنل بروید
2. Username و Password خود را یادداشت کنید

### روش 2: استفاده از API Key (اگر موجود باشد)
1. به بخش تنظیمات API بروید
2. API Key خود را دریافت کنید

---

## مرحله 4: تنظیم Environment Variables

در PowerShell:

```powershell
# انتخاب پنل
$env:SMS_PROVIDER="farazsms"

# روش 1: با Username/Password
$env:SMS_USERNAME="your_username"
$env:SMS_PASSWORD="your_password"
$env:SMS_SENDER="your_sender_number"  # شماره فرستنده
$env:SMS_PATTERN_CODE="your_pattern_code"  # کد پترن تایید شده

# روش 2: اگر API Key دارید
$env:SMS_API_KEY="your_api_key"
$env:SMS_PATTERN_CODE="your_pattern_code"

# URL API (معمولاً نیاز به تغییر ندارد)
$env:FARAZSMS_API_URL="https://ippanel.com/api/select"
$env:FARAZSMS_PATTERN_URL="https://ippanel.com/services.jspd"
```

---

## مرحله 5: تست

1. سرور را راه‌اندازی کنید
2. به `/master/login` بروید
3. شماره موبایل خود را وارد کنید
4. روی "ارسال کد ورود" کلیک کنید
5. کد OTP باید به شماره شما ارسال شود

---

## عیب‌یابی

### اگر پیامک ارسال نشد:
1. بررسی کنید که کد پترن تایید شده باشد
2. Username/Password را بررسی کنید
3. شماره فرستنده (Sender) را بررسی کنید
4. فرمت شماره موبایل را بررسی کنید (باید با 98 شروع شود)
5. لاگ‌های سرور را بررسی کنید

### بررسی لاگ:
در console سرور، خطاهای مربوط به ارسال SMS نمایش داده می‌شود.

---

## نکات مهم

- ⚠️ پترن باید قبل از استفاده تایید شود
- ⚠️ نام مجموعه/برند باید در متن پترن باشد
- ⚠️ متغیر `otp` باید دقیقاً به همین نام تعریف شود
- ⚠️ کد پترن بعد از تایید تغییر نمی‌کند

---

## مثال کامل متن پترن

```
سلام، کد ورود شما به پنل مدیریت کافه مادلین: {otp}
این کد تا 5 دقیقه معتبر است.
```

یا:

```
کافه مادلین
کد ورود شما: {otp}
این کد تا 5 دقیقه معتبر است.
```

